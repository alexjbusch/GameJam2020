pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
-- menu.p8
-- by neuya
--
-- stand alone menu component with native pico menu look and feel 
-- inspired by https://www.lexaloffle.com/bbs/?pid=56765&tid=31895


---- begin menu lib ----

menu = {
	
	items = {},
	rows = 6,
	cols = 17,
	bg = 0,
	fg = 7,
	selected = 1,
	active = false,

	init = function(self, items, callback)
		self.items = items
		self.callback = callback
		self.active = true
	end,

	update = function(self)
		if not self.active then
			return
		end
		-- up
		if btnp(2) then
			if self.selected == 1 then
				self.selected = #self.items
			else
				self.selected -= 1
			end
		end
		-- down
		if btnp(3) then
			if self.selected == #self.items then
				self.selected = 1
			else
				self.selected += 1
			end
		end
		-- select
		if btnp(4) or btnp(5) then
			local item = self.items[self.selected]
			local cb = item.action or self.callback
			if type(cb) == "function" then
				cb(item, self.selected)
			end
			self.active = false
		end
	end,

	draw = function(self)
		if not self.active then return end
		local offset = self.rows * flr((self.selected - 1) / self.rows)
		local w, h = self.cols * 5 + 4, self.rows * 8 + 12
		local cx, cy = (128 - w) / 2, (128 - h) / 2
		rectfill(cx, cy, cx +w - 1, cy + h - 1, self.bg)
		rect(cx + 2, cy + 2, cx + w - 3, cy + h - 3, self.fg)
		for i = 1 + offset, offset + self.rows do
			local item = self.items[i]
			if item then
				local x, y = cx + 3, cy + 8 * (i - offset)
				local label = item.label or ''
				if #label > self.cols then
					label = sub(label, 0, self.cols)
				end
				if self.selected == i then
					print('◆', x , y, self.fg)
					rectfill(x,y,x+2,y+4, self.bg)
					x+=1
				end
				print(label, x+9, y, self.fg)
			end
		end
	end

}
---- end menu lib ----


-- usage --

menu_items = {
	{ label = "celeste", action = function() load('#15133', 'quit') end },
	{ label = "mistigri", id='#21603' },
	{ label = "dank tomb", id='#42992' },
	{ label = "marballs 2", id='#34772' },
	{ label = "pico racer", id='#20068' },
	{ label = "just one boss", id='#49232' },
	{ label = "eight legs to love", id='#41422' },
	{ label = "pico tennis", id='#55359' },
	{ label = "swordfish", id='#51752' },
	{ label = "they started it", id='#27177' },
	{ label = "mai chans sweet buns", id='#56576' },
	{ label = "barp the balldragon", id='#54395' },
	{ label = "little dragon adventure", id='#53895' },
	{ label = "omega enforcer x", id='#41342' },
}

menu.rows = 6 -- tweak stuff eventualy

-- call menu:init(items) when you need it :
-- (callback is optional)

menu:init(menu_items, function(item) 
	load(item.id, 'quit') -- global callback if no menuitem action
end)

-- call menu:update and menu:draw on each frame :

function _update()
	menu:update() 
end

function _draw()
	cls(6)
	menu:draw()
	bar:draw() -- for demo only
end

-- for demo only

bar = {

 	draw = function ()
		local fg, bg, sec = 0, 7, ':'
		if stat(95) %2 == 0 then
			sec = ' '
		end
		local date = stat(93) .. sec .. stat(94)
		rectfill(0, 0, 128, 9, bg)
		line(0, 9, 128, 9, 0)
		print('◆pico-8', 2, 2, fg)
		print(date, 128 - #date * 4 - 2, 2)
	end

}

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777077770007000770077007777700077777777777777777777777777777777777777777777777777777777777777777777777770007007777770007000777
77770007770707707707770707777707077777777777777777777777777777777777777777777777777777777777777777777777777707707770777707070777
77700000770007707707770707000700077777777777777777777777777777777777777777777777777777777777777777777777770007707777777007000777
77770007770777707707770707777707077777777777777777777777777777777777777777777777777777777777777777777777770777707770777707070777
77777077770777000770070077777700077777777777777777777777777777777777777777777777777777777777777777777777770007000777770007000777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000066666666666666666666
66666666666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000066666666666666666666
66666666666666666660077777777777777777777777777777777777777777777777777777777777777777777777777777777777770066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070007000000077077707000777007707770777000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070007700000700070007000700070000700700000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070007770000700077007000770077700700770000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070007700000700070007000700000700700700000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070007000000077077707770777077000700777000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007770777007707770777007707770777000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007770070070000700070070007070070000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007070070077700700070070007700070000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007070070000700700070070707070070000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007070777077000700777077707070777000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007700777077007070000077700770777077700000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007070707070707070000007007070777070700000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007070777070707700000007007070707077000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007070707070707070000007007070707070700000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007770707070707070000007007700707077700000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007770777077707770777070007000077000007770000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007770707070707070707070007000700000000070000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007070777077007700777070007000777000007770000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007070707070707070707070007000007000007000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007070707070707770707077707770770000007770000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007770777007700770000077707770077077707770000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007070070070007070000070707070700070007070000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007770070070007070000077007770700077007700000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007000070070007070000070707070700070007070000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007000777007707700000070707070077077707070000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000007770707007707770000007707700777000007770077007700770000000000000000000000070066666666666666666666
66666666666666666660070000000000700707070000700000070707070700000007070707070007000000000000000000000000070066666666666666666666
66666666666666666660070000000000700707077700700000070707070770000007700707077707770000000000000000000000070066666666666666666666
66666666666666666660070000000000700707000700700000070707070700000007070707000700070000000000000000000000070066666666666666666666
66666666666666666660070000000007700077077000700000077007070777000007770770077007700000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660070000000000000000000000000000000000000000000000000000000000000000000000000000000000070066666666666666666666
66666666666666666660077777777777777777777777777777777777777777777777777777777777777777777777777777777777770066666666666666666666
66666666666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000066666666666666666666
66666666666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000066666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
66666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666

